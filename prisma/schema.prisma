generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model reviews {
  id          String    @id @default(uuid()) @db.Uuid
  user_id     String?   @db.Uuid
  target_type String    @db.VarChar(20)
  target_id   String    @db.VarChar(100)
  rating      Int?
  comment     String?
  created_at  DateTime? @default(now()) @db.Timestamp(6)
  updated_at  DateTime? @default(now()) @db.Timestamp(6) @updatedAt
  users       users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([target_type, target_id], map: "idx_reviews_target")
  @@unique([user_id, target_type, target_id], map: "uniq_review_target_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model routes {
  id                String   @id @db.VarChar(50)
  short_name        String?
  long_name         String?
  type              String?  @db.VarChar(10)
  fare              Int?
  forward_direction Boolean?
  trips             trips[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model saved_routes {
  id         String    @id @default(uuid()) @db.Uuid
  user_id    String?   @db.Uuid
  route_id   String?   @db.VarChar(100)
  title      String?
  from_stop  String?   @db.VarChar(50)
  to_stop    String?   @db.VarChar(50)
  mode       String?   @db.VarChar(50)
  options    String?   @db.VarChar(50)
  route_data Json?
  saved_at   DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6) @updatedAt
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_saved_routes_user")
  @@unique([user_id, route_id], map: "uniq_saved_route_user")
}

model stop_times {
  trip_id        String    @db.VarChar(50)
  stop_id        String?   @db.VarChar(50)
  arrival_time   DateTime? @db.Time(6)
  departure_time DateTime? @db.Time(6)
  stop_sequence  Int
  stops          stops?    @relation(fields: [stop_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  trips          trips     @relation(fields: [trip_id], references: [trip_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([trip_id, stop_sequence])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model stops {
  id         String       @id @db.VarChar(50)
  name       String
  lat        Float
  lng        Float
  type       String?      @db.VarChar(10)
  stop_times stop_times[]
}

model trips {
  trip_id    String       @id @db.VarChar(50)
  route_id   String?      @db.VarChar(50)
  stop_times stop_times[]
  routes     routes?      @relation(fields: [route_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id             String           @id @default(uuid()) @db.Uuid
  name           String?
  email          String           @unique
  password       String
  role           String           @default("user")
  created_at     DateTime?        @default(now()) @db.Timestamp(6)
  updated_at     DateTime?        @default(now()) @db.Timestamp(6) @updatedAt
  path_url       String?
  reviews        reviews[]
  saved_routes   saved_routes[]
  search_history search_history[]
}

model search_history {
  id         String    @id @default(uuid()) @db.Uuid
  user_id    String?   @db.Uuid
  from_label String?
  from_lat   Float?
  from_lng   Float?
  to_label   String?
  to_lat     Float?
  to_lng     Float?
  created_at DateTime? @default(now()) @db.Timestamp(6)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_history_user")
}
